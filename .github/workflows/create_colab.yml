name: Create Minecraft Colab Server

on:
  workflow_dispatch:
    inputs:
      username:
        description: "User requesting server"
        required: true
      server_name:
        description: "Server name"
        required: true
      software:
        description: "Software (paper/spigot/fabric/vanilla)"
        required: true
      version:
        description: "Minecraft version (e.g., 1.20.1)"
        required: true

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Create Colab Notebook
        run: |
          mkdir -p servers/${{ github.event.inputs.username }}
          NOTEBOOK_PATH="servers/${{ github.event.inputs.username }}/${{ github.event.inputs.server_name }}.ipynb"
          
          cat > $NOTEBOOK_PATH << 'EOF'
          {
            "cells": [
              {
                "cell_type": "markdown",
                "metadata": {},
                "source": [
                  "# ðŸš€ Minecraft Server Setup (Generated by GitHub Actions)\n",
                  "This notebook will prepare and launch your Minecraft server in **Google Colab**.\n",
                  "---\n",
                  "### Server Info:\n",
                  "- **Software**: ${{ github.event.inputs.software }}\n",
                  "- **Version**: ${{ github.event.inputs.version }}\n",
                  "- **Server Name**: ${{ github.event.inputs.server_name }}\n",
                  "- **Owner**: ${{ github.event.inputs.username }}\n",
                  "---\n"
                ]
              },
              {
                "cell_type": "code",
                "execution_count": null,
                "metadata": {},
                "outputs": [],
                "source": [
                  "# âœ… Install Java (for Minecraft)\n",
                  "!apt-get update -y\n",
                  "!apt-get install -y openjdk-17-jre-headless\n",
                  "!java -version"
                ]
              },
              {
                "cell_type": "code",
                "execution_count": null,
                "metadata": {},
                "outputs": [],
                "source": [
                  "# ðŸ“¥ Download Minecraft Server JAR\n",
                  "SOFTWARE = \"${{ github.event.inputs.software }}\"\n",
                  "VERSION = \"${{ github.event.inputs.version }}\"\n",
                  "print(f\"Preparing {SOFTWARE} {VERSION} server...\")\n",
                  "\n",
                  "# TODO: Add actual download logic based on SOFTWARE\n",
                  "# Example (Paper):\n",
                  "# !wget -O server.jar https://api.papermc.io/v2/projects/paper/versions/${VERSION}/builds/latest/downloads/paper-${VERSION}.jar"
                ]
              },
              {
                "cell_type": "code",
                "execution_count": null,
                "metadata": {},
                "outputs": [],
                "source": [
                  "# â–¶ï¸ Start Minecraft Server\n",
                  "print(\"Starting Minecraft server...\")\n",
                  "!java -Xmx2G -Xms1G -jar server.jar nogui"
                ]
              }
            ],
            "metadata": {
              "colab": {
                "name": "Minecraft Server - ${{ github.event.inputs.server_name }}",
                "provenance": []
              },
              "kernelspec": {
                "display_name": "Python 3",
                "language": "python",
                "name": "python3"
              },
              "language_info": {
                "name": "python"
              }
            },
            "nbformat": 4,
            "nbformat_minor": 0
          }
          EOF

      - name: Commit Notebook
        run: |
          git config --global user.name "github-actions"
          git config --global user.email "actions@github.com"
          git add servers/${{ github.event.inputs.username }}/${{ github.event.inputs.server_name }}.ipynb
          git commit -m "Add Colab notebook for ${{ github.event.inputs.server_name }}" || echo "No changes"
          git push

      - name: Show Colab Link
        run: |
          echo "### âœ… Your Colab Notebook is Ready!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ”— [Open Colab](https://colab.research.google.com/github/${{ github.repository }}/blob/main/servers/${{ github.event.inputs.username }}/${{ github.event.inputs.server_name }}.ipynb)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Use 'Runtime > Run all' in Colab to launch your server." >> $GITHUB_STEP_SUMMARY

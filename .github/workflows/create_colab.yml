name: Create Minecraft Colab

on:
  workflow_dispatch:
    inputs:
      username:
        description: "User ID / Username"
        required: true
      server_name:
        description: "Server name"
        required: true
      software:
        description: "Server software (paper/spigot/vanilla)"
        required: true
      version:
        description: "Minecraft version (e.g., 1.20.1)"
        required: true

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write   # allow commits

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Create servers folder if not exists
      run: mkdir -p servers/${{ github.event.inputs.username }}

    - name: Generate Colab Notebook
      run: |
        FILE="servers/${{ github.event.inputs.username }}/${{ github.event.inputs.server_name }}.ipynb"
        
        cat > $FILE <<EOL
{
 "cells": [
  {
   "cell_type": "code",
   "metadata": {},
   "source": [
    "# Install Java\\n",
    "!apt-get update -y && apt-get install -y openjdk-17-jre"
   ]
  },
  {
   "cell_type": "code",
   "metadata": {},
   "source": [
    "# Download Minecraft Server\\n",
    "SOFTWARE = \\"${{ github.event.inputs.software }}\\"\\n",
    "VERSION = \\"${{ github.event.inputs.version }}\\"\\n",
    "!echo 'Downloading server: ' + SOFTWARE + ' ' + VERSION"
   ]
  },
  {
   "cell_type": "code",
   "metadata": {},
   "source": [
    "# Start the Server\\n",
    "!java -Xmx2G -Xms1G -jar server.jar nogui"
   ]
  }
 ],
 "metadata": {
  "colab": {
   "name": "MC Server - ${{ github.event.inputs.server_name }}"
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
EOL

    - name: Commit notebook
      run: |
        git config --global user.name "github-actions"
        git config --global user.email "actions@github.com"
        git add servers/${{ github.event.inputs.username }}/${{ github.event.inputs.server_name }}.ipynb
        git commit -m "Add Colab notebook for ${{ github.event.inputs.server_name }}" || echo "No changes to commit"
        git push

    - name: Output Colab Link
      run: |
        echo "Colab Link: https://colab.research.google.com/github/${{ github.repository }}/blob/main/servers/${{ github.event.inputs.username }}/${{ github.event.inputs.server_name }}.ipynb" >> $GITHUB_STEP_SUMMARY

name: Create Colab Notebook

on:
  workflow_dispatch:
    inputs:
      server_name:
        description: 'Server Name'
        required: true
      software:
        description: 'Software (paper/spigot/purpur)'
        required: true
      version:
        description: 'Minecraft Version'
        required: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Generate Notebook
        run: |
          mkdir -p servers
          FILE="servers/${{ github.event.inputs.server_name }}.ipynb"
          cat > $FILE <<EOL
          {
            "cells": [
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "!apt-get update -y && apt-get install -y openjdk-17-jdk"
                ]
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "!wget -O server.jar https://api.papermc.io/v2/projects/${{ github.event.inputs.software }}/versions/${{ github.event.inputs.version }}/builds/1/downloads/${{ github.event.inputs.software }}-${{ github.event.inputs.version }}-1.jar"
                ]
              },
              {
                "cell_type": "code",
                "metadata": {},
                "source": [
                  "!java -Xmx2G -jar server.jar nogui"
                ]
              }
            ],
            "metadata": {
              "kernelspec": {
                "display_name": "Python 3",
                "language": "python",
                "name": "python3"
              }
            },
            "nbformat": 4,
            "nbformat_minor": 0
          }
          EOL

      - name: Commit Notebook
        run: |
          git config --global user.name "Colab Bot"
          git config --global user.email "bot@lunarhost520.com"
          git add servers/${{ github.event.inputs.server_name }}.ipynb
          git commit -m "Added notebook for ${{ github.event.inputs.server_name }}"
          git push

      - name: Show Colab Link
        run: |
          echo "âœ… Notebook created!"
          echo "ðŸ”— Open in Colab:"
          echo "https://colab.research.google.com/github/lunarhost520/lunarhost-server/blob/main/servers/${{ github.event.inputs.server_name }}.ipynb"
